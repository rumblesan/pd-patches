#N canvas 49 235 847 936 12;
#N canvas 361 264 959 709 fft-analysis 1;
#X obj 56 486 *~;
#X obj 23 486 *~;
#X obj 23 508 -~;
#X obj 172 484 *~;
#X obj 141 484 *~;
#X obj 141 506 +~;
#X obj 114 202 *~;
#X obj 83 202 *~;
#X obj 55 202 *~;
#X obj 24 202 *~;
#X obj 24 227 +~;
#X obj 128 394 *~;
#X obj 23 631 *~;
#X obj 239 439 rfft~;
#X obj 123 170 rfft~;
#X obj 23 573 rifft~;
#X obj 23 655 outlet~;
#X obj 98 394 *~;
#X obj 98 416 +~;
#X obj 129 227 -~;
#X obj 23 440 *~;
#X obj 56 441 *~;
#X obj 370 652 block~;
#X obj 24 358 +~ 1e-15;
#X obj 23 607 *~;
#X obj 56 607 tabreceive~ \$0-hann;
#X obj 127 655 expr 2/(3*$f1);
#X msg 370 627 set \$1 4;
#X obj 98 440 q8_rsqrt~;
#N canvas 156 417 1029 827 read-windows 1;
#X obj 146 667 *~;
#X obj 276 282 f;
#X obj 200 99 /;
#X obj 325 669 *~;
#X obj 276 231 bang~;
#X obj 146 531 line~;
#X obj 200 124 * 1000;
#X obj 318 284 +;
#X obj 446 254 *;
#X obj 294 341 / 1000;
#X obj 276 368 *;
#X text 308 368 reading location (samples);
#X obj 165 574 / 4;
#X floatatom 469 475 7 0 0 0 - - -;
#X obj 146 693 outlet~;
#X obj 325 694 outlet~;
#X obj 343 638 tabreceive~ \$0-hann;
#X obj 294 317 r \$0-insamprate;
#X floatatom 199 146 5 0 0 0 - - -;
#X obj 200 75 t f b;
#X obj 232 99 samplerate~;
#X obj 199 171 / 4;
#X obj 313 394 / 2;
#X obj 276 394 -;
#X text 349 391 back up 1/2 window;
#X obj 146 597 -~;
#X text 337 52 Read two windows out of the recorded sample \, one 1/4
ahead of the other. The mid point of the front window is specified
by "location". If "speed" is nonzero \, "location" automatically precesses.
, f 45;
#X text 24 582 "back" window 1/4 cycle behind "front" one, f 16;
#X text 230 171 computation period (msec) for overlap of 4;
#X text 252 145 msec in a window;
#X obj 146 449 f;
#X obj 146 420 b;
#X msg 146 503 0 \, \$1 \$2;
#X obj 146 476 pack f f;
#X obj 200 51 r \$0-window-size;
#X obj 294 256 r \$0-playhead-pos;
#X text 500 246 loop to precess the playhead position according to
the "speed" parameter., f 22;
#X obj 469 451 r \$0-stretched-window-size;
#X obj 409 532 r \$0-sample-array-name;
#X msg 409 556 set \$1;
#X obj 146 631 tabread4~;
#X obj 324 611 tabread4~;
#X obj 446 201 r \$0-speed;
#X obj 353 288 s \$0-current-ph-pos;
#X floatatom 219 309 7 0 0 0 - - -;
#X floatatom 222 268 5 0 0 0 - - -;
#X floatatom 472 230 5 0 0 0 - - -;
#X floatatom 327 442 5 0 0 0 - - -;
#X connect 0 0 14 0;
#X connect 1 0 7 0;
#X connect 1 0 10 0;
#X connect 1 0 44 0;
#X connect 2 0 6 0;
#X connect 3 0 15 0;
#X connect 4 0 1 0;
#X connect 5 0 25 0;
#X connect 5 0 41 0;
#X connect 6 0 18 0;
#X connect 7 0 1 1;
#X connect 7 0 43 0;
#X connect 8 0 7 1;
#X connect 9 0 10 1;
#X connect 10 0 23 0;
#X connect 12 0 25 1;
#X connect 13 0 12 0;
#X connect 13 0 22 0;
#X connect 13 0 30 1;
#X connect 16 0 3 1;
#X connect 16 0 0 1;
#X connect 17 0 9 0;
#X connect 18 0 21 0;
#X connect 19 0 2 0;
#X connect 19 1 20 0;
#X connect 20 0 2 1;
#X connect 21 0 8 1;
#X connect 21 0 33 1;
#X connect 22 0 23 1;
#X connect 23 0 31 0;
#X connect 23 0 40 1;
#X connect 23 0 41 1;
#X connect 23 0 47 0;
#X connect 25 0 40 0;
#X connect 30 0 33 0;
#X connect 31 0 30 0;
#X connect 32 0 5 0;
#X connect 33 0 32 0;
#X connect 34 0 19 0;
#X connect 35 0 1 1;
#X connect 35 0 45 0;
#X connect 37 0 13 0;
#X connect 38 0 39 0;
#X connect 39 0 40 0;
#X connect 39 0 41 0;
#X connect 40 0 0 0;
#X connect 41 0 3 0;
#X connect 42 0 8 0;
#X connect 42 0 46 0;
#X restore 123 142 pd read-windows;
#X text 277 14 recall previous output amplitude. Its phase will be
added to the phase difference we measure from two windows in the the
recorded sound.;
#X obj 126 78 *~;
#X obj 99 78 *~;
#X obj 99 100 +~;
#X obj 164 103 q8_rsqrt~;
#X obj 164 80 +~ 1e-20;
#X obj 83 128 *~;
#X obj 24 127 *~;
#X obj 34 254 lrshift~ 1;
#X obj 29 278 lrshift~ -1;
#X obj 146 254 lrshift~ 1;
#X obj 138 278 lrshift~ -1;
#X obj 42 309 *~;
#X obj 164 321 *~;
#X obj 24 334 +~;
#X obj 130 321 +~;
#X text 252 75 divide by the magnitude to make a unit-magnitude complex
amplitude (phase only). The 1e-20 is to prevent overflows. q8_rsqrt~
is reciprocal square root.;
#X text 252 174 Take FT of the window in back. Multiply its conjugate
by the normalized previous output. The result has the magnitude of
the input sound and phase (previous output phase) minus (back window
phase).;
#X text 254 379 Normalize again \, this time taking care to salt each
channel with 1e-15 so that we get a unit complex number even if everything
was zero heretofore.;
#X text 287 435 Now take the FT of the forward window and multiply
it by the unit complex number from above. The magnitude will be that
of the forward window and the phase will be the previous output phase
plus the phase difference between the two analysis windows -- except
that if "lock" is on \, they will be modified to agree progressively
better with the inter-channel phase relationships of the input.;
#X text 306 249 If "lock" is on \, encourage neighboring channels to
stay in phase by adding the two neighboring complex amplitudes. The
result will tend toward the channel with the strongest amplitude. If
the phase relationships between channels in the output and those in
the input are in parallel \, then neighboring channels of the quotient
will all have the same phase and this will not change any phases. (lrshift
shifts the signal to the left or right depending on its argument.)
;
#X text 264 135 Read two windows \, one 1/4 length behind the other
\, of the input sound \, with Hann window function (see inside).;
#X text 341 566 'set' message to block allows variable size, f 22
;
#X obj 25 14 tabreceive~ \$0-prev-real;
#X obj 83 38 tabreceive~ \$0-prev-imag;
#X obj 141 541 tabsend~ \$0-prev-imag;
#X obj 140 574 tabsend~ \$0-prev-real;
#X obj 127 633 r \$0-window-size;
#X obj 370 603 r \$0-window-size;
#X obj 182 299 r \$0-lock;
#X connect 0 0 2 1;
#X connect 1 0 2 0;
#X connect 2 0 15 0;
#X connect 2 0 56 0;
#X connect 3 0 5 1;
#X connect 4 0 5 0;
#X connect 5 0 15 1;
#X connect 5 0 55 0;
#X connect 6 0 19 1;
#X connect 7 0 19 0;
#X connect 8 0 10 1;
#X connect 9 0 10 0;
#X connect 10 0 39 0;
#X connect 10 0 38 0;
#X connect 10 0 44 0;
#X connect 11 0 18 1;
#X connect 12 0 16 0;
#X connect 13 0 1 1;
#X connect 13 0 3 1;
#X connect 13 1 0 1;
#X connect 13 1 4 1;
#X connect 14 0 9 1;
#X connect 14 0 7 1;
#X connect 14 1 6 1;
#X connect 14 1 8 1;
#X connect 15 0 24 0;
#X connect 17 0 18 0;
#X connect 18 0 28 0;
#X connect 19 0 40 0;
#X connect 19 0 41 0;
#X connect 19 0 45 0;
#X connect 20 0 1 0;
#X connect 20 0 4 0;
#X connect 21 0 0 0;
#X connect 21 0 3 0;
#X connect 23 0 17 1;
#X connect 23 0 17 0;
#X connect 23 0 20 0;
#X connect 24 0 12 0;
#X connect 25 0 24 1;
#X connect 26 0 12 1;
#X connect 27 0 22 0;
#X connect 28 0 20 1;
#X connect 28 0 21 1;
#X connect 29 0 14 0;
#X connect 29 1 13 0;
#X connect 31 0 33 1;
#X connect 32 0 33 0;
#X connect 33 0 35 0;
#X connect 34 0 36 1;
#X connect 34 0 37 1;
#X connect 35 0 34 0;
#X connect 36 0 8 0;
#X connect 36 0 7 0;
#X connect 37 0 9 0;
#X connect 37 0 6 0;
#X connect 38 0 42 0;
#X connect 39 0 42 0;
#X connect 40 0 43 0;
#X connect 41 0 43 0;
#X connect 42 0 44 1;
#X connect 43 0 45 1;
#X connect 44 0 23 0;
#X connect 45 0 11 0;
#X connect 45 0 11 1;
#X connect 45 0 21 0;
#X connect 53 0 32 1;
#X connect 53 0 32 0;
#X connect 53 0 37 0;
#X connect 54 0 31 1;
#X connect 54 0 31 0;
#X connect 54 0 36 0;
#X connect 57 0 26 0;
#X connect 58 0 27 0;
#X connect 59 0 42 1;
#X connect 59 0 43 1;
#X restore 80 801 pd fft-analysis;
#X obj 80 825 outlet~;
#N canvas 0 23 478 732 prev-windows 0;
#N canvas 0 0 450 300 (subpatch) 0;
#X array \$0-prev-imag 4096 float 0;
#X coords 0 1000 4096 -1000 400 300 1 0 0;
#X restore 36 360 graph;
#N canvas 0 0 450 300 (subpatch) 0;
#X array \$0-prev-real 4096 float 0;
#X coords 0 500 4096 -500 400 300 1 0 0;
#X restore 37 37 graph;
#X restore 80 753 pd prev-windows;
#N canvas 910 220 577 494 window-funcs 0;
#N canvas 0 0 450 300 (subpatch) 0;
#X array \$0-hann 2048 float 0;
#X coords 0 1 2047 0 300 100 1;
#X restore 110 315 graph;
#X obj 345 129 osc~;
#X obj 345 154 *~ -0.5;
#X obj 345 178 +~ 0.5;
#X obj 328 221 tabwrite~ \$0-hann;
#X obj 175 182 /;
#X obj 193 150 samplerate~;
#X obj 57 196 swap;
#X obj 57 220 /;
#X obj 186 210 * 1000;
#X obj 104 93 t f b f;
#X msg 193 100 resize \$1;
#X obj 193 124 s \$0-hann;
#X msg 370 99 0;
#X obj 297 95 t f b;
#X obj 104 58 r \$0-window-size;
#X obj 57 244 s \$0-window-hz;
#X obj 186 237 s \$0-window-msec;
#X obj 297 67 r \$0-window-hz;
#X connect 1 0 2 0;
#X connect 2 0 3 0;
#X connect 3 0 4 0;
#X connect 5 0 9 0;
#X connect 6 0 5 1;
#X connect 6 0 7 1;
#X connect 7 0 8 0;
#X connect 7 1 8 1;
#X connect 8 0 16 0;
#X connect 9 0 17 0;
#X connect 10 0 5 0;
#X connect 10 0 7 0;
#X connect 10 1 6 0;
#X connect 10 2 11 0;
#X connect 11 0 12 0;
#X connect 13 0 1 1;
#X connect 14 0 1 0;
#X connect 14 1 4 0;
#X connect 14 1 13 0;
#X connect 15 0 10 0;
#X connect 18 0 14 0;
#X restore 80 777 pd window-funcs;
#X obj 77 36 inlet;
#X obj 77 60 dispatch \$0 sample-array;
#X obj 427 223 + 69;
#X obj 427 248 mtof;
#X obj 427 275 / 440;
#X floatatom 471 276 5 0 0 0 - - -;
#X obj 427 199 * 0.01;
#X floatatom 435 371 7 0 0 0 - - -;
#X obj 427 347 *;
#X obj 435 323 t b f;
#X text 489 359 stretched window size (samples), f 16;
#X obj 427 299 r \$0-window-size;
#X obj 427 394 s \$0-stretched-window-size;
#X obj 77 108 dispatch \$0 transpose 0;
#X obj 77 132 dispatch \$0 lock 0;
#X obj 77 84 dispatch \$0 window-size 2048;
#X obj 77 156 dispatch \$0 speed 0;
#X obj 427 53 r \$0-sample-array;
#X obj 427 104 unpack s f;
#X obj 427 77 t a b;
#X obj 524 104 s \$0-insamprate;
#X obj 524 78 f 44100;
#X obj 427 128 s \$0-sample-array-name;
#X obj 77 180 dispatch \$0 playhead-pos 0;
#X msg 464 813 playhead-pos \$1;
#X obj 464 837 s \$0-output;
#X obj 337 803 r \$0-output;
#X obj 337 827 outlet;
#X obj 429 482 + 69;
#X obj 429 507 mtof;
#X obj 429 534 / 440;
#X floatatom 473 535 5 0 0 0 - - -;
#X obj 429 458 * 0.01;
#X floatatom 437 630 7 0 0 0 - - -;
#X obj 429 606 *;
#X obj 437 582 t b f;
#X text 491 618 stretched window size (samples), f 16;
#X obj 429 558 r \$0-window-size;
#X obj 429 653 s \$0-stretched-window-size;
#X obj 429 434 r \$0-transpose;
#X obj 464 789 r \$0-current-ph-pos;
#X obj 427 175 r \$0-transpose;
#X connect 0 0 1 0;
#X connect 4 0 5 0;
#X connect 5 0 19 0;
#X connect 6 0 7 0;
#X connect 7 0 8 0;
#X connect 7 0 9 0;
#X connect 8 0 13 0;
#X connect 10 0 6 0;
#X connect 12 0 11 0;
#X connect 12 0 16 0;
#X connect 13 0 12 0;
#X connect 13 1 12 1;
#X connect 15 0 12 0;
#X connect 17 0 18 0;
#X connect 18 0 20 0;
#X connect 19 0 17 0;
#X connect 20 0 27 0;
#X connect 21 0 23 0;
#X connect 22 0 26 0;
#X connect 22 1 24 0;
#X connect 23 0 22 0;
#X connect 23 1 25 0;
#X connect 25 0 24 0;
#X connect 28 0 29 0;
#X connect 30 0 31 0;
#X connect 32 0 33 0;
#X connect 33 0 34 0;
#X connect 33 0 35 0;
#X connect 34 0 39 0;
#X connect 36 0 32 0;
#X connect 38 0 37 0;
#X connect 38 0 42 0;
#X connect 39 0 38 0;
#X connect 39 1 38 1;
#X connect 41 0 38 0;
#X connect 43 0 36 0;
#X connect 44 0 28 0;
#X connect 45 0 10 0;
